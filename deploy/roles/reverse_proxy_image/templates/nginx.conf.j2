# {{ ansible_managed }}
#{% for app_sufix in range( ansible_processor_vcpus|int ) %}
#env APP_WEB_{{ '%02d' % app_sufix|int }};
#{% endfor %}

worker_processes 4;

events {

    worker_connections 1024;

}

http {

#    upstream {{ app_name }} {
#        least_conn;
#        server {{ app_name }}:8080;
#        {% for app_sufix in range( ansible_processor_vcpus|int ) %}
#        server $ENV{"APP_WEB_{{ '%02d' % app_sufix|int }}"}:8080;
#        {% endfor %}
#    }
     
    server {
        listen 80;
     
        location / {
#            proxy_pass http://{{ app_name }};
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
    }

}
